<Window x:Class="Wind3_ImageTestTool.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Wind3_ImageTestTool"
        mc:Ignorable="d"
        Title="Wind3 색수차 보정 ver 2.0" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 상단 메인 버튼들 -->
        <Grid Grid.Row="0" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Content="1. TIF 이미지 로드" 
                    Style="{StaticResource firstButton}"
                    Command="{Binding LoadTiffCommand}" IsEnabled="{Binding IsLoadButtonEnabled}"/>

            <Button Grid.Column="1" Content="{Binding CorrectionButtonText}" 
                    Style="{StaticResource secondButton}"
                    Command="{Binding CorrectAberrationCommand}" IsEnabled="{Binding IsCorrectionButtonEnabled}"/>

            <Button Grid.Column="2" Content="3. TIF 추출" 
                    Style="{StaticResource thirdButton}"
                    Command="{Binding ExportTiffCommand}" IsEnabled="{Binding IsExportButtonEnabled}"/>
        </Grid>

        <!-- 옵션 패널 -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="10,5" HorizontalAlignment="Center">
            <TextBlock Text="보정 방법:" VerticalAlignment="Center" Margin="0,0,10,0" FontWeight="Bold"/>
            <RadioButton Content="NCC" IsChecked="{Binding IsNccSelected}" Margin="0,0,20,0" VerticalAlignment="Center"/>
            <RadioButton Content="ORB" IsChecked="{Binding IsOrbSelected}" Margin="0,0,20,0" VerticalAlignment="Center"/>

            <Separator Width="1" Height="20" Margin="10,0" Background="Gray"/>

            <Separator Width="1" Height="20" Margin="10,0" Background="Gray"/>

            <CheckBox Content="B채널 생성" IsChecked="{Binding GenerateBChannel}" 
                      VerticalAlignment="Center" Margin="10,0" FontWeight="Bold"/>

            <ComboBox SelectedIndex="{Binding BChannelMethodIndex}" Margin="5,0" Width="120" VerticalAlignment="Center"
                      IsEnabled="{Binding GenerateBChannel}">
                <ComboBoxItem Content="평균 (R+G)/2"/>
                <ComboBoxItem Content="가중치 (G 70%)"/>
                <ComboBoxItem Content="G채널만"/>
            </ComboBox>

            <Separator Width="1" Height="20" Margin="10,0" Background="Gray"/>
            <TextBlock Text="진행률:" VerticalAlignment="Center" Margin="20,0,5,0"/>
            <ProgressBar Width="150" Height="20" Margin="5,0" Value="{Binding ProgressValue}"/>
            <TextBlock Text="{Binding ProgressText}" VerticalAlignment="Center" Margin="10,0"/>
        </StackPanel>

        <!-- 메인 콘텐츠 영역 -->
        <TabControl Grid.Row="2" Margin="10">

            <!-- 원본 이미지 탭 -->
            <TabItem Header="원본 이미지">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="{Binding OriginalImageInfo}" 
                               Margin="10" FontWeight="Bold" Padding="5"/>

                    <!-- 프레임 네비게이션 컨트롤 -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="10,5">
                        <Button Content="◀ 이전" Command="{Binding PreviousFrameCommand}" 
                                IsEnabled="{Binding IsPreviousFrameEnabled}"
                                Style="{StaticResource grayButton}"/>

                        <TextBlock Text="{Binding CurrentFrameText}" 
                                   VerticalAlignment="Center" Margin="15,0" 
                                   FontWeight="Bold" FontSize="14"/>

                        <Button Content="다음 ▶" Command="{Binding NextFrameCommand}" 
                                IsEnabled="{Binding IsNextFrameEnabled}"
                                Style="{StaticResource grayButton}"/>

                        <Separator Width="1" Height="25" Margin="15,0" Background="Gray"/>

                        <TextBlock Text="프레임 직접 이동:" VerticalAlignment="Center" Margin="10,0,5,0"/>
                        <TextBox Text="{Binding FrameInputText, UpdateSourceTrigger=PropertyChanged}" 
                                 Width="50" Height="25" VerticalContentAlignment="Center" Margin="0,0,5,0"/>
                        <Button Content="이동" Command="{Binding GoToFrameCommand}" 
                                Padding="8,3" Style="{StaticResource grayButton}"/>

                        <TextBlock Text="{Binding FrameNavigationStatus}" 
                                   VerticalAlignment="Center" Margin="15,0" 
                                   Foreground="DarkBlue" FontStyle="Italic"/>
                    </StackPanel>

                    <ScrollViewer Grid.Row="2" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                        <Image Source="{Binding OriginalImageSource}" 
                               Stretch="Uniform" 
                               HorizontalAlignment="Center" 
                               VerticalAlignment="Center"
                               MouseLeftButtonDown="Image_MouseLeftButtonDown"
                               MouseRightButtonDown="Image_MouseRightButtonDown"
                               MouseMove="Image_MouseMove"
                               MouseLeftButtonUp="Image_MouseLeftButtonUp"
                               MouseRightButtonUp="Image_MouseRightButtonUp"/>
                    </ScrollViewer>
                </Grid>
            </TabItem>

            <!-- ROI 설정 탭 -->
            <TabItem Header="ROI 설정">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="163*"/>
                        <ColumnDefinition Width="1003*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- 전체 이미지 표시 -->
                    <Grid Grid.Row="1" Margin="5" Grid.ColumnSpan="2">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="전체 이미지 (ROI 영역 표시)" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                            <Border>
                                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" MaxHeight="600">
                                    <Image Source="{Binding OriginalImageSource}" 
                                           Stretch="Uniform"
                                           MouseLeftButtonDown="Image_MouseLeftButtonDown"
                                           MouseRightButtonDown="Image_MouseRightButtonDown"
                                           MouseMove="Image_MouseMove"
                                           MouseLeftButtonUp="Image_MouseLeftButtonUp"
                                           MouseRightButtonUp="Image_MouseRightButtonUp"/>
                                </ScrollViewer>
                            </Border>
                            <TextBlock Text="{Binding DefectsCount}" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Grid>

                    <!-- ROI 설정 상태 표시 -->
                    <Border Grid.Row="2" Margin="5" Padding="10" CornerRadius="5" Grid.ColumnSpan="2">
                        <StackPanel>
                            <TextBlock Text="{Binding ROIStatus}" FontWeight="Bold" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </TabItem>

            <!-- 보정 결과 탭 -->
            <TabItem Header="보정 결과">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 프레임 네비게이션 컨트롤 (보정 결과용) -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="10,5">
                        <TextBlock Text="보정 결과 프레임 네비게이션:" VerticalAlignment="Center" Margin="0,0,15,0" FontWeight="Bold"/>

                        <Button Content="◀ 이전" Command="{Binding PreviousFrameCommand}" 
                                IsEnabled="{Binding IsPreviousFrameEnabled}"
                                Style="{StaticResource grayButton}"/>

                        <TextBlock Text="{Binding CurrentFrameText}" 
                                   VerticalAlignment="Center" Margin="15,0" 
                                   FontWeight="Bold" FontSize="14"/>

                        <Button Content="다음 ▶" Command="{Binding NextFrameCommand}" 
                                IsEnabled="{Binding IsNextFrameEnabled}"
                                Style="{StaticResource grayButton}"/>

                        <Separator Width="1" Height="25" Margin="15,0" Background="Gray"/>

                        <TextBlock Text="프레임 이동:" VerticalAlignment="Center" Margin="10,0,5,0"/>
                        <TextBox Text="{Binding FrameInputText, UpdateSourceTrigger=PropertyChanged}" 
                                 Width="50" Height="25" VerticalContentAlignment="Center" Margin="0,0,5,0"/>
                        <Button Content="이동" Command="{Binding GoToFrameCommand}" 
                                Style="{StaticResource grayButton}"/>

                        <TextBlock Text="{Binding FrameNavigationStatus}" 
                                   VerticalAlignment="Center" Margin="15,0" 
                                   Foreground="DarkBlue" FontStyle="Italic"/>
                    </StackPanel>

                    <!-- 보정 전/후 비교 이미지 -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- 보정 전 -->
                        <StackPanel Grid.Column="0" Margin="5">
                            <TextBlock Text="보정 전" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                                <Image Source="{Binding BeforeCorrectionImageSource}" Stretch="Uniform"/>
                            </ScrollViewer>
                        </StackPanel>

                        <!-- 보정 후 -->
                        <StackPanel Grid.Column="1" Margin="5">
                            <TextBlock Text="보정 후" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                                <Image Source="{Binding AfterCorrectionImageSource}" Stretch="Uniform"/>
                            </ScrollViewer>
                        </StackPanel>
                    </Grid>
                </Grid>
            </TabItem>

            <!-- RGB 채널 탭 -->
            <TabItem Header="RGB 채널">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 프레임 네비게이션 컨트롤 (RGB 채널용) -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="10,5">
                        <TextBlock Text="RGB 채널 프레임 네비게이션:" VerticalAlignment="Center" Margin="0,0,15,0" FontWeight="Bold"/>

                        <Button Content="◀ 이전" Command="{Binding PreviousFrameCommand}" 
                                IsEnabled="{Binding IsPreviousFrameEnabled}"
                                Style="{StaticResource grayButton}"/>

                        <TextBlock Text="{Binding CurrentFrameText}" 
                                   VerticalAlignment="Center" Margin="15,0" 
                                   FontWeight="Bold" FontSize="14"/>

                        <Button Content="다음 ▶" Command="{Binding NextFrameCommand}" 
                                IsEnabled="{Binding IsNextFrameEnabled}"
                                Style="{StaticResource grayButton}"/>

                        <Separator Width="1" Height="25" Margin="15,0" Background="Gray"/>

                        <TextBlock Text="프레임 이동:" VerticalAlignment="Center" Margin="10,0,5,0"/>
                        <TextBox Text="{Binding FrameInputText, UpdateSourceTrigger=PropertyChanged}" 
                                 Width="50" Height="25" VerticalContentAlignment="Center" Margin="0,0,5,0"/>
                        <Button Content="이동" Command="{Binding GoToFrameCommand}" 
                                Style="{StaticResource grayButton}"/>

                        <TextBlock Text="{Binding FrameNavigationStatus}" 
                                   VerticalAlignment="Center" Margin="15,0" 
                                   Foreground="DarkBlue" FontStyle="Italic"/>
                    </StackPanel>

                    <!-- RGB 채널 이미지 -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- R 채널 -->
                        <StackPanel Grid.Column="0" Margin="5">
                            <TextBlock Text="R 채널" FontWeight="Bold" Foreground="Red" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Height="400">
                                <Image Source="{Binding RChannelImageSource}" Stretch="Uniform"/>
                            </ScrollViewer>
                        </StackPanel>

                        <!-- G 채널 (기준) -->
                        <StackPanel Grid.Column="1" Margin="5">
                            <TextBlock Text="G 채널 (기준)" FontWeight="Bold" Foreground="Green" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Height="400">
                                <Image Source="{Binding GChannelImageSource}" Stretch="Uniform"/>
                            </ScrollViewer>
                        </StackPanel>

                        <!-- B 채널 -->
                        <StackPanel Grid.Column="2" Margin="5">
                            <TextBlock Text="B 채널" FontWeight="Bold" Foreground="Blue" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Height="400">
                                <Image Source="{Binding BChannelImageSource}" Stretch="Uniform"/>
                            </ScrollViewer>
                        </StackPanel>
                    </Grid>
                </Grid>
            </TabItem>

            <!-- 로그 탭 -->
            <TabItem Header="처리 로그">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- 로그 제어 버튼 -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5" >
                        <Button Content="로그 초기화" Command="{Binding ClearLogCommand}" 
                                Style="{StaticResource grayButton}"/>
                        <TextBlock Text="처리 로그" VerticalAlignment="Center" FontWeight="Bold"/>
                    </StackPanel>

                    <!-- 로그 표시 영역 -->
                    <ScrollViewer Grid.Row="1">
                        <TextBox Text="{Binding LogText}" IsReadOnly="True" Background="Black" Foreground="White" 
                             FontFamily="Consolas" FontSize="12" TextWrapping="Wrap"
                             VerticalScrollBarVisibility="Auto" Margin="5"/>
                    </ScrollViewer>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- 하단 상태바 -->
        <Grid Grid.Row="3" Background="LightGray" Height="30">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="{Binding StatusText}" VerticalAlignment="Center" Margin="10,0"/>
            <TextBlock Grid.Column="1" Text="{Binding ProcessingTimeText}" VerticalAlignment="Center" Margin="10,0"/>
        </Grid>
    </Grid>
</Window>
